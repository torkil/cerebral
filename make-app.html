<html>
<head>

  <title></title>

  <link rel="stylesheet" type="text/css" href="style/main.css">
  <link rel="stylesheet" type="text/css" href="style/github-highlight.css">

  <script type="text/javascript" src="./js/rainbow-min.js"></script>

</head>
<body>

  <header>
    <nav>
      <ul>
        <li class="end"><a href="https://github.com/gorillatron/cerebral">github</a></li>
        <li>API Reference</li>
        <li class="active">Guide</li>
        <li> <a href="./index.html">Home</a></li>
      </ul>
    </nav>
  </header>

  <section id="content" class="guide">

    <h1>Lets make an app!</h1>

    <p>
      The app will consist of two simple modules. A todo module, but of course, and an achievements module for tracking and
      showing achievements the user earn while learning the very complex todo app.
    </p>

    <h3>require.js and backbone.js</h3>

    <p>
      Both modules will use requirejs to load submodules like models, views and collections. These models, collections and views will be 
      extended versions of backbone classes loaded through cerebral.
    </p>

    <p>
      Through the core we will start and stop the todo and achivements modules, this is using require.js behind the scenese to load, unload,
      define a individual sandbox namespace for the modules and cleanup after them when they are stopped.
    </p>

    <h2>Directory layout</h2>

    <p>
      Heres a quick overview of the directory layout of the app we are going to make.
    </p>

    <div class="dir-layout">
      
      <div class="dir">
        <div class="name">. . / . . / cerebral /</div>
        <div class="content">
          <div class="file desc">this is where cerebral lib is located</div>
        </div>
      </div>

      <div class="dir">
        <div class="name">app /</div>
        <div class="content">

          <div class="file html">index.html</div>

          <div class="dir">
            <div class="name">style /</div>
            <div class="content">
              <div class="file desc">..style and graphics..</div>
            </div>
          </div>

          <div class="dir">
            <div class="name">js /</div>
            <div class="content">

              <div class="file js">app.js</div>

              <div class="dir">
                <div class="name">modules/ </div>
                <div class="content">

                  <div class="dir">
                    <div class="name">todos /</div>
                    <div class="content">

                      <div class="file js">main.js</div>

                      <div class="dir">
                        <div class="name">models /</div>
                        <div class="content">
                          <div class="file js">Todo.js</div>
                        </div>
                      </div>

                      <div class="dir">
                        <div class="name">views /</div>
                        <div class="content">
                          <div class="file js">Todos.js</div>
                          <div class="file js">Todo.js</div>
                        </div>
                      </div>

                      <div class="dir">
                        <div class="name">collections /</div>
                        <div class="content">
                          <div class="file js">Todos.js</div>
                        </div>
                      </div>

                    </div>
                  </div>

                  <div class="dir">
                    <div class="name">achievements /</div>
                    <div class="content">

                      <div class="file js">main.js</div>

                      <div class="dir">
                        <div class="name">models /</div>
                        <div class="content">
                          <div class="file js">Achievement.js</div>
                        </div>
                      </div>

                      <div class="dir">
                        <div class="name">views /</div>
                        <div class="content">
                          <div class="file js">Achievements.js</div>
                          <div class="file js">Achievement.js</div>
                        </div>
                      </div>

                      <div class="dir">
                        <div class="name">collections /</div>
                        <div class="content">
                          <div class="file js">Achievements.js</div>
                        </div>
                      </div>

                    </div>
                  </div>

                </div>
              </div>


            </div>
          </div>

        </div>
      </div>

    </div>

    <h3>Setup</h3>

    <p>
      First lets set up the index.html file. Include require.js and configure it so it knows where to look for things like; cerebral, backbone, underscore,
      jquery and the app itself.
    </p>

    <pre>
      <code data-language="html">
  &lt;script type="text/javascript" src="../../cerebral/vendor/require.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript"&gt;

        require.config({
          baseUrl: "../../",
          shim: {
            "backbone": {
              deps: ["underscore", "jquery"],
              exports: "Backbone"
            },
            "underscore": {
              exports: "_"
            },
          },
          paths: {
            "backbone": "cerebral/vendor/backbone",
            "backboneLocalStorage": "docs/demo/js/ext/Backbone.LocalStorage",
            "underscore": "cerebral/vendor/underscore",
            "jquery": "cerebral/vendor/jquery",
            "app": "docs/demo/js"
          }
        })

  &lt;/script&gt;
      </code>
    </pre>

    <p>
      We allso have to add some mock data for the app to work. We will attach this directly to the global namespace under namespace bootstrap
      so its easy to reach for our modules.
    </p>

    <pre>
      <code data-language="json">
  window.bootstrap = {}

  window.bootstrap.todos = [
    {
      description: "Open app",
      completed: true
    },
    {
      description: "Complete this, while beeing a boss is optional.",
      completed: false
    }
  ]

  window.bootstrap.achievements = [
    {
      tag: "firsttodo",
      description: "Create your first todo",
      completed: false
    },
    {
      tag: "firstcomplete",
      description: "Complete your first todo",
      completed: false
    },
    {
      tag: "removetodo",
      description: "Remove your first todo",
      completed: false
    },
    {
      tag: "threetodos",
      description: "Create three todos",
      completed: false
    }
  ]
      </code>
    </pre>

    <h3>app.js</h4>

    <p>
      Now its time to get our hands dirty and code the main application file, app.js. We will configure it to know where to look for 
      its modules and then start them up. Since they are manipulating the DOM we tell them to wait for the DOM to be ready, this is default behaviour
      but we set it to true for clarity.
    </p>

    <pre>
      <code data-language="js">
  require([
    "cerebral/application/core",
    "jquery"
  ],
  function( core, $ ) {

    core.configure({
      moduleRoot: 'app/modules/'
    })

    core.start("todos", {
      element: "#todos",
      onDomReady: true
    })

    core.start("achievements", {
      element: "#achievements",
      onDomReady: true
    })

  })
      </code>
    </pre>

    <h3>todos / main.js</h3>

    <p>
      When the core was told to start the module `todos` it automaticaly looked for a main.js file directly under the modules namespace(directory).
      Loaded it and checked if it either returned a function or an object(can allso be a function) that contained a main method and tries to invoke it.
      <br/><br/>
      Lets look at the code:
    </p>

    <pre>
      <code data-language="js">
  define([
    "todos/sandbox",
    "./collections/Todos",
    "./views/Todos"
  ], 
  function( sandbox, Todos, TodosView ){
    
    return function main() {

      var todos = new Todos()

      todos.fetch()

      var moduleView = new TodosView({
        el: sandbox.element,
        collection: todos
      })

      moduleView.render()

    }

  })
      </code>
    </pre>

    <p>
      The main function does a couple of interesting things:
      <ul>
        <li>Fetches its sandbox. more details on the sandbox later.</li>
        <li>Creates a new Todos collection and fetches its content.</li>
        <li>Creates a new TodosView and passes it the element the module has been assigned.</li>
        <li>Renders the view to the DOM.</li>
      </ul>
    </p>


    <h3>achievements / main.js</h3>

    <p>
      The achievments module is concerned with two things:

      <ul>
        <li>Keeping track of the achievments by subscribing to events elswhere in the application(todos).</li>
        <li>and updating the achievments view anytime the user completes an achievement.</li>
      </ul>

      <br/><br/>
      Lets look at the code:
    </p>

    <pre>
      <code data-language="js">
  define([
    "achievements/sandbox",
    "./collections/Achievements",
    "./views/Achievements"
  ], 
  function( sandbox, Achievements, AchievementsView ){
    
    return function main() {

      var achievements = new Achievements()

      achievements.reset( window.bootstrap.achievements  )

      var stats = {
        nrOfTodosAdded: 0
      }

      sandbox.subscribe("todos.add", function() {
        stats.nrOfTodosAdded++
        if( stats.nrOfTodosAdded === 1 ) {
          achievements.complete({ tag: "firsttodo" })
        }
        if( stats.nrOfTodosAdded === 3 ) {
          achievements.complete({ tag: "threetodos" })
        }
      })

      sandbox.subscribe("todos.remove", function() {
        achievements.complete({ tag: "removetodo" })

        sandbox.unsubscribe("todos.remove")
      })

      sandbox.subscribe("todos.modelChange", function( model, changes ) {
        if( model.get('completed') )
          achievements.complete({ tag: "firstcomplete" })
      })

      var moduleView = new AchievementsView({
        el: sandbox.element,
        collection: achievements
      })

      moduleView.render()

    }

  })
      </code>
    </pre>

  </section>

<footer>
    <div class="credits">
      Built by Andre Tangen <span class="gorillatron"><a href="https://twitter.com/gorillatron">@gorillatron</a></span> and <span class="wtw"><img src="style/gfx/wtw3.png"></span>
    </div>
  </footer>

</body>
</html>